<!DOCTYPE html>
<!-- saved from url=(0057)https://guitar.ucsd.edu/maeece148/index.php/2019FallTeam2 -->
<html class="client-js" lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Autonomous-Mail-Delivery-Robot</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"2019FallTeam2","wgTitle":"2019FallTeam2","wgCurRevisionId":4345,"wgRevisionId":4345,"wgArticleId":505,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"2019FallTeam2","wgRelevantArticleId":505,"wgRequestId":"72c8d0e89d234c6eef0c4661","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","user.tokens":"loading","ext.embedVideo.styles":"ready","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.options@0j3lz3q",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens@1ks84gt",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["ext.embedVideo","mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="./2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/load.php">
<script async="" src="./2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/load(1).php"></script>
<style>
@media screen {
	.tochidden,.toctoggle{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.toctoggle{font-size:94%}}
@media print {
	#toc.tochidden,.toc.tochidden,.toctoggle{display:none}}
.postedit-container{margin:0 auto;position:fixed;top:0;height:0;left:50%;z-index:1000;font-size:13px}.postedit-container:hover{cursor:pointer}.postedit{position:relative;top:0.6em;left:-50%;padding:0.6em 3.6em 0.6em 1.1em;line-height:1.5625em;color:#626465;background-color:#f4f4f4;border:1px solid #dcd9d9;text-shadow:0 0.0625em 0 rgba( 255,255,255,0.5 );border-radius:5px;box-shadow:0 2px 5px 0 #ccc;-webkit-transition:all 0.25s ease-in-out;-moz-transition:all 0.25s ease-in-out;-ms-transition:all 0.25s ease-in-out;-o-transition:all 0.25s ease-in-out;transition:all 0.25s ease-in-out}.skin-monobook .postedit{top:6em !important; }.postedit-faded{opacity:0}.postedit-icon{padding-left:41px;  line-height:25px;background-repeat:no-repeat;background-position:8px 50%}.postedit-icon-checkmark{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB9ElEQVR4AZWRA3AYURQArxrVHtW2bdu2bdu2zdi2bdu2bWxs7zeehZaw4f70kbs+zI3e/nWK+RWx3aOFlrL56Sy5SxrruG69hlv6OyK+mz+8KDSXdXembj0ispT7tjs4ZTIbpYBvxGSGKzZTeFrb7W/meN002swFs0U8ttpHTkF2BvCqWQrW35929bTsKm5Zb+SEwWwcY8wAngB9m7Z+d+rIPZ/npdy12M5p47n8dXsCYAf0qPy06eGMdktuDu9Qf+JmKl3SWM91qzVcN9tAbEYkwMaq0tyb1m/To5kP170el/BK8/qa6sJr70ydf+T/Uu5ab+Oo/lS0AkUBpIFWlZ9WPhxpse/PHO7YbOOczjL0vZV2lNxPPtG73dYXM+xvm2znrOl83tidoqCwMBgYXsPFB0on5S6pr+eK5TKuW67lgvaKvF8mL1dtfTL32FHxRdyx3cQpg7m4x9sCXKkTIzA4LDH44zWdzaUf71hv5rTG4uyzcusybxSX7aThbMQ8XgCYAp3rzTTQOiIh9PNlzY3FSuZxrzjme1Y7uGS6kjsWO4jPjM4FVjRZsvD4kO9XtTZzQn82NyzWc0B7AmZh6gA/hOYSGhfw9YbOVnarj+S7800AL2BIsxUAbWNToj7bhBuQmZcOsFdoKUC74rGheCwXmqAIQTc9jQcrADIAAAAASUVORK5CYII=);background-image:url(/maeece148/resources/src/mediawiki.action/images/green-checkmark.png?d94f1)!ie;background-position:left}.postedit-close{position:absolute;padding:0 0.8em;right:0;top:0;font-size:1.25em;font-weight:bold;line-height:2.3em;color:#000;text-shadow:0 0.0625em 0 #fff;text-decoration:none;opacity:0.2;filter:alpha( opacity=20 )}.postedit-close:hover{color:#000;text-decoration:none;opacity:0.4;filter:alpha( opacity=40 )}
.suggestions{overflow:hidden;position:absolute;top:0;left:0;width:0;border:0;z-index:1099;padding:0;margin:-1px 0 0 0}.suggestions-special{position:relative;background-color:#fff;cursor:pointer;border:solid 1px #aaa;margin:0;margin-top:-2px;display:none;padding:0.25em 0.25em;line-height:1.25em}.suggestions-results{background-color:#fff;cursor:pointer;border:solid 1px #aaa;padding:0;margin:0}.suggestions-result{color:#000;margin:0;line-height:1.5em;padding:0.01em 0.25em;text-align:left; overflow:hidden;-o-text-overflow:ellipsis; text-overflow:ellipsis;white-space:nowrap}.suggestions-result-current{background-color:#4c59a6;color:#fff}.suggestions-special .special-label{color:#808080;text-align:left}.suggestions-special .special-query{color:#000;font-style:italic;text-align:left}.suggestions-special .special-hover{background-color:#c0c0c0}.suggestions-result-current .special-label,.suggestions-result-current .special-query{color:#fff}.highlight{font-weight:bold}</style><style>
.suggestions a.mw-searchSuggest-link,.suggestions a.mw-searchSuggest-link:hover,.suggestions a.mw-searchSuggest-link:active,.suggestions a.mw-searchSuggest-link:focus{color:#000;text-decoration:none}.suggestions-result-current a.mw-searchSuggest-link,.suggestions-result-current a.mw-searchSuggest-link:hover,.suggestions-result-current a.mw-searchSuggest-link:active,.suggestions-result-current a.mw-searchSuggest-link:focus{color:#fff}.suggestions a.mw-searchSuggest-link .special-query{ overflow:hidden;-o-text-overflow:ellipsis; text-overflow:ellipsis;white-space:nowrap}</style><meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.29.0">
<link rel="shortcut icon" href="favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="MAE/ECE 148 - Introduction to Autonomous Vehicles (en)">
<link rel="EditURI" type="application/rsd+xml" href="api.php?action=rsd">
<link rel="copyright" href="https://creativecommons.org/licenses/by-sa/4.0/">
<link rel="alternate" type="application/atom+xml" title="MAE/ECE 148 - Introduction to Autonomous Vehicles Atom feed" href="https://guitar.ucsd.edu/maeece148/index.php?title=Special:RecentChanges&amp;feed=atom">
<script src="./2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/load(2).php"></script></head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-2019FallTeam2 rootpage-2019FallTeam2 skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<div class="mw-indicators mw-body-content">
</div>
			<h1 id="firstHeading" class="firstHeading" lang="en">2019 Fall Team 2</h1>
									<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From MAE/ECE 148 - Introduction to Autonomous Vehicles</div>
								<div id="contentSub"></div>
</div>

<h2><span class="mw-headline" id="Project_Objective">Project Objective</span></h2>
<p>Modify the Donkey Car framework and physical car to autonomously deliver personalized mail to multiple different destinations based on number. Ideally, the Donkey Car model will be trained to do autonomous laps while hugging the right side of the road. Upon recognizing a mailbox number using OpenCV, the car will stop, queue the right package to be delivered, push the package off the side of the vehicle and continue on to the next delivery. 
</p>
<dl><dd>Must have:
<dl><dd><ul><li>Deliver personalized mail to or directly in front of all destinations. Personalized means that the address (in this case number) determines what mail is delivered.</li>
<li>Train the car to do laps in autonomous mode and then deliver mail when near a driveway by using its mechanical on board systems</li></ul></dd></dl></dd></dl>
<dl><dd>Nice to have
<dl><dd><ul><li>User controls where the mail gets delivered. Assigns numbers/symbols to individual mail on top of the car. In one trial, the user may assign the number 3 to package 2 and in another trial they can assign number 3 to package 4, etc. </li>
<li>Train the car to hug the right side of the road in autonomous mode</li>
<li> Car can recognize and associate QR codes with correct package. Essentially using QR codes instead of numbers.</li></ul></dd></dl></dd></dl>
<p><br>
</p>
<hr>
<h2><span class="mw-headline" id="The_Team">The Team</span></h2>
<p>(from left to right)
</p>
<ul><li>Andrew Ma, MAE</li>
<li>Bijan Ardalan, MAE</li>
<li>Lucas Hwang, ECE</li></ul>
<div class="thumb tright"><div class="thumbinner" style="width:402px;">
    <div class="image">
        <img alt="TeamPic.jpg" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/400px-TeamPic.jpg" width="400" height="300" class="thumbimage" srcset="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/600px-TeamPic.jpg 1.5x, 2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/800px-TeamPic.jpg 2x">
    </div>
    <div class="thumbcaption"><div class="magnify">
        <span class="internal" title="Enlarge"></span>
    </div></div>
</div></div>
<p><br>
</p>
<hr>
<h2><span class="mw-headline" id="Mechanical_Design">Mechanical Design</span></h2>
<h3><span class="mw-headline" id="Acrylic_Mounting_Plate">Acrylic Mounting Plate</span></h3>
<p>Our mounting plate was designed very early on in the design process so our specific requirements were largely unknown at the time. The acrylic piece was designed to allow standard size motors to be mounted in the center and fed down through the middle gap of the baseplate. It was also designed with holes for a couple different screw sizes for mounting different components onto it. thin slots were designed in the front and back for zip ties and larger slots were put on the sides for cable management. We laser-cut the plate out of 1/4th inch acrylic since we had an idea that the plate would have to be pretty stiff to hold the entire mechanical package delivery system.
</p>
<div class="thumb tleft"><div class="thumbinner" style="width:402px;">
    <div class="image">
        <img alt="" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/400px-Base_Plate_Render.jpg" width="400" height="247" class="thumbimage" srcset="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/600px-Base_Plate_Render.jpg 1.5x, 2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/800px-Base_Plate_Render.jpg 2x">
    </div>
    <div class="thumbcaption"><div class="magnify">
        <span class="internal" title="Enlarge"></span>
    </div>A render of the base plate design.</div>
</div></div>
<div class="thumb tright"><div class="thumbinner" style="width:402px;">
    <div class="image">
        <img alt="" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/400px-Base_Plate_Drawing.jpg" width="400" height="211" class="thumbimage" srcset="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/600px-Base_Plate_Drawing.jpg 1.5x, 2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/800px-Base_Plate_Drawing.jpg 2x">
    </div>
    <div class="thumbcaption"><div class="magnify">
        <span class="internal" title="Enlarge"></span>
    </div>The dimensions used (in mm) in the base plate design above.</div>
</div></div>
<h3><span class="mw-headline" id="Camera_Mounting">Camera Mounting</span></h3>
<p>We originally angled our camera down 60 degrees from horizontal in order to capture a large image of the ground and track lines. However, in order to capture the numbers for our package delivery on the side of the road, this angle was decreased to 30 degrees to capture more of the horizon. The camera was held 195 mm above the acrylic base plate. We also designed an optional +-10 degree extender piece just in case we needed to fine-tune the camera angle further. This piece can be seen clearly in the exploded view below.
</p>
<div class="thumb tleft"><div class="thumbinner" style="width:402px;">
    <div class="image">
        <img alt="" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/400px-CameraMountFinal.jpg" width="400" height="696" class="thumbimage" srcset="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/600px-CameraMountFinal.jpg 1.5x, 2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/CameraMountFinal.jpg 2x">
    </div>
    <div class="thumbcaption"><div class="magnify">
        <span class="internal" title="Enlarge"></span>
    </div>The final camera mounting solution for the mail delivery system.</div>
</div></div>
<div class="thumb tright"><div class="thumbinner" style="width:402px;">
    <div class="image">
        <img alt="" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/CameraMountFinalExploded.jpg" width="400" height="384" class="thumbimage" srcset="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/600px-CameraMountFinalExploded.jpg 1.5x, 2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/800px-CameraMountFinalExploded.jpg 2x">
    </div>
    <div class="thumbcaption"><div class="magnify">
        <span class="internal" title="Enlarge"></span>
    </div>An exploded view of the final camera mounting solution.</div>
</div></div>
<p><br>
</p>
<div class="thumb tright"><div class="thumbinner" style="width:502px;">
    <div class="image">
        <img alt="" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/500px-CameraMountDrawing.jpg" width="500" height="264" class="thumbimage" srcset="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/750px-CameraMountDrawing.jpg 1.5x, 2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/1000px-CameraMountDrawing.jpg 2x">
    </div>
    <div class="thumbcaption"><div class="magnify">
        <span class="internal" title="Enlarge"></span>
    </div>The dimensions used in our camera mounting design.</div>
</div></div>
<h3><span class="mw-headline" id="Jetson_Case">Jetson Case</span></h3>
<p>To house our Jetson Nano, we 3D printed a case taken off of Thingiverse at <span class="external free">https://www.thingiverse.com/thing:3518410</span></p>
<p><div class="image">
    <img alt="Jetson Case.jpg" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/400px-Jetson_Case.jpg" width="400" height="301" srcset="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/600px-Jetson_Case.jpg 1.5x, 2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Jetson_Case.jpg 2x">
</div></p>
<h3><span class="mw-headline" id="Mail_Delivery_Mechanism">Mail Delivery Mechanism</span></h3>
<p>We used a double rack and pinion design and two linear sliders for the moving components of the build. The racks were rigidly attached to the linear sliders and the motors were rigidly attached to the base plate to enable linear motion and two degrees of freedom. The package rack and pinion selects a package to deliver and then the push rack and pinion knocks the package off the car near the sign. We designed the rack and pinions in SolidWorks and then laser cut them out of acrylic. Standoffs were designed to accommodate the different heights necessary. The packages are also held down in case of a bumpy ride by Velcro.
</p>
<div class="thumb tleft"><div class="thumbinner" style="width:402px;">
    <div class="image">
        <img alt="" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/MechanismAnnotated.jpg" width="400" height="311" class="thumbimage" srcset="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/600px-MechanismAnnotated.jpg 1.5x, 2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/800px-MechanismAnnotated.jpg 2x">
    </div>
    <div class="thumbcaption"><div class="magnify">
        <span class="internal" title="Enlarge"></span>
    </div>The complete mechanical mechanism for the mail delivery system.</div>
</div></div>
<div class="embedvideo autoResize" style=""><div class="embedvideowrap" style="width: 640px;"><iframe src="./2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/-6h5Rdy1oOc.html" width="640" height="360" frameborder="0" allowfullscreen="true"></iframe></div></div>
<h3><span class="mw-headline" id="Choosing_The_Motors">Choosing The Motors</span></h3>
<p>Our design requirements were based on the need to precisely choose a package to deliver. We chose to use servo motors instead of DC motors because they have internal control systems which saves us from having to design and implement external sensors and a control system.
Originally we used the servo motors already in the lockers, however we realized that they were "position" servos that had a limited degree of rotation. For our design that used a rack and pinion system, this wouldn't work, so instead of redesigning everything we ordered continuous rotation servos.
The servos we used can be found here. <span class="external autonumber">[1]</span>
Our design uses two servo motors, one for each rack and pinion.
</p>
<h3><span class="mw-headline" id="Sign_Design">Sign Design</span></h3>
<p>We ended up using neon pink construction paper with numbers drawn in black marker for our signs. This design was optimal as the construction paper was matte and did not have any glare when photos were taken with the webcam. We had tried using other materials like folders and we found that the glare off the surface made it hard for OpenCV to properly recognize contours. Here you can see the original picture with glare on the left circled in red. On the right is the edged copy where you can see the contour for the construction paper is not complete due to the glare. 
</p><p><div class="image">
    <img alt="Team2 2019 Glare 1.PNG" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_Glare_1.PNG" width="324" height="274">
</div><div class="image">
    <img alt="Team2 2019 Glare 2.PNG" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/400px-Team2_2019_Glare_2.PNG" width="400" height="319" srcset="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/600px-Team2_2019_Glare_2.PNG 1.5x, 2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_Glare_2.PNG 2x">
</div>
</p><p>Additionally, we tried a few different colors of construction paper before settling on pink. The camera has a tendency of adding a blue tint to everything in the picture, so pink stood out the most out of all the colors. Additionally, we 3D printed stands for our signs and used cardboard as a backing so we would be able to freely switch out the color as well as rotate them. Here are pictures captured on the camera of the orange and pink signs.
</p><p><br>
<div class="image">
    <img alt="Team2 2019 SignOrange.jpeg" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_SignOrange.jpeg" width="320" height="180">
</div><div class="image">
    <img alt="Team2 2019 SignPink.jpeg" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_SignPink.jpeg" width="320" height="180">
</div>
</p>
<p><br>
</p>
<hr>
<h2><span class="mw-headline" id="Electronic_Design">Electronic Design</span></h2>
<h3><span class="mw-headline" id="Robocar_Wiring_Schematic">Robocar Wiring Schematic</span></h3>
<p><div class="image">
    <img alt="Fall2019Team2Schematic.jpeg" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/600px-Fall2019Team2Schematic.jpeg" width="600" height="512" srcset="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/900px-Fall2019Team2Schematic.jpeg 1.5x, 2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/1200px-Fall2019Team2Schematic.jpeg 2x">
</div></p>
<h2><span class="mw-headline" id="Software_Design">Software Design</span></h2>
<h3><span class="mw-headline" id="Software_Overview">Software Overview</span></h3>
<p>The software can be divided into two parts, which are the motor control and OpenCV number recognition respectively. For the motor control we created our own class called myMotor.py which was added into the parts folder. We based this file off the actuator.py file which already exists as a part in Donkey. myMotor.py contains two classes (myMotor and myMotorThrottle). The myMotor class is in charge of initialization of default values for the motor as well as interfacing with the PWM board (the PCA9685). The myMotorThrottle class contains methods which set the pulse for the motors and thereby controls how fast the motors spin.
</p>
<h3><span class="mw-headline" id="Servo_Motors">Servo Motors</span></h3>
<p>To control the servo motors on top of the car, we used a modified version of actuator.py, which can be found in the default DonkeyCar parts file, since we used the same PWM board to control both the steering and throttle servos as well as the mail delivery servos. Once we created the class, it was simply a matter of adding it as a part to manage.py so the DonkeyCar framework recognized the part.
</p><p>MyMotor.py takes advantage of the imported Adafruit PCA9685 library for the corresponding PWM board to set the PWM signal. We then manually determined the pulse time constant.
The pulse time constant represents how much time it takes to move the slider one box over. For example, moving from box 3 to box 5 would mean spinning the motor for two times the pulse constant and so on. In order to change the default motor speeds, we added the part to the myconfig.py file found in the d3 directory as well as the config variables for the PWM pulses required to stop the motor, spin it clockwise, and spin it counterclockwise.
</p>
<h3><span class="mw-headline" id="Neural_Network_Training">Neural Network Training</span></h3>
<p>For our neural network training we did not make any changes to the original Donkeycar framework. We used about 12,000 records in order to train a model indoors. One of the main reasons we decided to train our car indoors, was due to the rainy weather outside. The rain not only damaged the signs that we created but also negatively affected our number recognition. This was because there was very low brightness when it rained as opposed to other times when we had trained the model, making it hard for our camera to recognize the proper contours needed for number recognition. 
</p><p>Although the number recognition software operates separately from the Donkeycar framework, it was important to train the model with the signs on the course. If we added the signs after the car had been trained, there was the possibility that the car would not know how to respond when seeing a sign. This is due to the fact that the model associates steering and throttle with a given array of RGB values. we concluded that if we were to introduce a sudden change in the RGB values (i.e. adding a neon pink sign to the course) that the model was accustomed to seeing, our model would not perform as well.
</p>
<h3><span class="mw-headline" id="Number_Recognition_Methodology">Number Recognition Methodology</span></h3>
<p>Although number recognition can be done in a variety of ways, for our project we decided to use seven-segment number recognition. This process can be broken down into several steps:
</p><p><br>
<b>1. Color Filtering</b>
</p><p>In order to create a region of interest within all photos taken by the camera on the car, we decided to make the sign neon pink. Therefore, the first action that we wanted the number recognition software to accomplish was recognizing cropping the photo to only look at the pink construction paper where the number was written. In order to do this, we created a mask using RGB filtering to filter out all colors except for pink. We also know that the sign will be on the right side of the screen so we automatically crop the photo to the right half. Here is a picture of the original input to our camera and the black and white mask we created after color filtering. White represents all pink within the photo and black represents every other color.
<div class="image">
    <img alt="Team2 2019 NumberRecongition ColorFiltering 1.PNG" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_NumberRecongition_ColorFiltering_1.PNG" width="324" height="214">
</div><div class="image">
    <img alt="Team2 2019 NumberRecongition ColorFiltering 2.PNG" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_NumberRecongition_ColorFiltering_2.PNG" width="164" height="214">
</div>
</p><p><br>
</p><p><b>2. Contour Recognition</b>
</p><p>OpenCV defines a contour as any continuous line of the same color. For our software, there are two contours which need to be recognized. The first contour we call the display contour. This contour is the outline of the construction paper and is easily recognized within OpenCV after the color filtering has been applied. After cropping the photo to only the display contour, we need to recognize the digit contour. This is the contour formed by the digit drawn on the piece of construction paper. The photo is cropped for a final time after the digit contour is found. Two photos of both contours: 
</p><p><div class="image">
    <img alt="Team2 2019 NumberRecongition Contour 1.PNG" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/250px-Team2_2019_NumberRecongition_Contour_1.PNG" width="250" height="298" srcset="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/375px-Team2_2019_NumberRecongition_Contour_1.PNG 1.5x, 2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_NumberRecongition_Contour_1.PNG 2x">
</div> <div class="image">
    <img alt="Team2 2019 NumberRecongition Contour 2.PNG" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_NumberRecongition_Contour_2.PNG" width="217" height="162">
</div>
</p><p><br>
</p><p><b>3. Seven Segement Recognition</b>
</p><p>After isolating the digit contour. The program splits the photo into seven different segments. It then compares how much of each segment is filled with white pixels. If over 50% of a segment is filled with white pixels, then the segment is considered to be present. After repeating this process, a lookup is performed on a dictionary which has digit values associated with each unique seven segment key. 
</p><p><div class="image">
    <img alt="Team2 2019 NumberRecongition SevenSegment 1.PNG" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_NumberRecongition_SevenSegment_1.PNG" width="122" height="104">
</div><div class="image">
    <img alt="Team2 2019 NumberRecongition SevenSegment 2.PNG" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_NumberRecongition_SevenSegment_2.PNG" width="122" height="104">
</div>
</p>
<h3><span class="mw-headline" id="Number_Recognition_Code">Number Recognition Code</span></h3>
<p>The code first defines a a dictionary for all 10 digits and the corresponding segements which light up in a seven segment display. Each 1, within the DIGITS_LOOKUP represents a lit up segement on a seven segment display.
</p><p><div class="image">
    <img alt="Team2 2019 CodeSnip 1.png" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_CodeSnip_1.png" width="435" height="529">
</div></p><p><br>
Next, the code defines the upper and lower bounds for the RGB mask, applies the mask to the photo, and then crops the photo to only the right half.
</p><p><div class="image">
    <img alt="Team2 2019 CodeSnip 2.png" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_CodeSnip_2.png" width="470" height="228">
</div></p><p>The image is resized and an edge map is created. The program finds all contours within the edge map and then sorts them.
</p><p><div class="image">
    <img alt="Team2 2019 CodeSnip 3.png" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_CodeSnip_3.png" width="475" height="310">
</div></p><p>The program iterates through each contour and stops once it has found a contour of the right size. This contour becomes the display contour which represents the piece of pink construction paper. 
</p><p><div class="image">
    <img alt="Team2 2019 CodeSnip 4.png" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_CodeSnip_4.png" width="543" height="378">
</div></p><p>The image is then cropped to just the display contour and a series of operations are applied in order to clean up the photo. This reduces noise and makes it easier to recognize the digit contour. The same process of looking for contours in then repeated to find the digit contour. 
</p><p><div class="image">
    <img alt="Team2 2019 CodeSnip 5.png" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_CodeSnip_5.png" width="438" height="346">
</div></p><p>This is the second for loop which looks for the digit contour. Once a contour of the appropriate size is found, the image is again cropped to only the digit contour.
</p><p><div class="image">
    <img alt="Team2 2019 CodeSnip 6.png" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_CodeSnip_6.png" width="473" height="465">
</div></p><p>The seven segments are defined and for the digit contour and the program counts the number of pixels within each segment that are nonzero. If the number of "on" pixels in a given segment is greater than 50% of total pixels in the segment, then this segment is considered on. After all segments have been analyzed, a lookup is performed within the dictionary for the number which has these corresponding segments. 
</p><p><div class="image">
    <img alt="Team2 2019 CodeSnip 7.png" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_CodeSnip_7.png" width="804" height="650">
</div></p>
<h3><span class="mw-headline" id="Switching_between_Delivering_Mail_and_Driving_Autonomously">Switching between Delivering Mail and Driving Autonomously</span></h3>
<p>For our project, we decided to not incorporate the mail delivery mechanism as part of the training. We felt that adding extra inputs to the model (servos A and B on top of the car), would introduce too many variables and make it harder for the car to properly drive itself. As a result, the OpenCV script is solely used for number recognition and the Donkeycar framework is only used for autonomous driving. This creates an easy division of labor and allows us to test each piece of software individually in order to verify that it accomplishes its job. However, these two pieces of software cannot operate completely separate as they must work together on the same car. Therefore, in order to integrate the two different pieces of software, we incorporated the OpenCV script into the update_parts method within Donkeycar. Each time update_parts runs, a photo is taken and ran through the OpenCV script. If no number is recognized, the car continues driving. However, if the script recognizes a number, then the throttle for the car is set to zero and the motor sequence is started. After the motor sequence finishes, the throttle is reset and the car can continue driving autonomously. Additionally, we implemented a previous digit instance variable which prevents the car from continually recognizing the same digit while it is stopped. If the digit recognized is the same as the previous digit, then the car continues to run. In this way, the car is always trying to drive itself and the throttle is simply cut if an appropriate number is recognized.
</p><p><div class="image">
    <img alt="Team2 2019 CodeSnip 8.png" src="2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/Team2_2019_CodeSnip_8.png" width="685" height="337">
</div></p>
<p><br>
</p>
<hr>
<h2><span class="mw-headline" id="Lessons_Learned">Lessons Learned</span></h2>
<h3><span class="mw-headline" id="Useful_Knowledge">Useful Knowledge</span></h3>
<p>Here is a list of things we learned over the course of this project which may be helpful for teams in the future:
</p><p>1. Native Camera Aspect Ratio
</p><p>We learned from Team 6 that the native camera aspect ratio is 16:9. They helped us implement code which allows our camera to take photos in its native resolution. This is important as it prevents distortion which can sometimes make it hard to recognize numbers. Especially when objects are in the peripherals of the camera it can be hard to recognize digits as they start to bend excessively. 
</p><p>2. Continuous Rotation vs. Position Servos
</p><p>It is important to know whether or not your design requires continuous rotation servos or position servos. If position servos are used, then you will be specifying an angle that you want the servos to rotate to. For example, our servos rotated between 120 and 360 degrees. This is opposed to continuous rotation servos where you specify a speed at which they pulse at. We switched back and forth between the two kinds until we finally decided on continuous rotation servos. 
</p><p>3. Weight/Space Management
</p><p>We designed our parts without taking into consideration size/weight, which ended up overcrowding our robocar. As a result, we had to spend a lot of time reorganizing electronics in order to make sure all of our parts fit properly. Additionally, the increased weight made it so parts of our car sagged and touched the wheels. This was a problem when driving as it made it hard for our car to move and go around turns. In order to fix this, we replaced our current springs with stronger ones. It is important to know how big your components are and plan where they are going to go before buying and testing them on the car.
</p>
<h3><span class="mw-headline" id="Challenges_and_Solutions">Challenges and Solutions</span></h3>
<p>This quarter we had a lot of problems with broken parts. We spent a lot of time diagnosing which electronic components were faulty and waiting for new parts. Some of the issues we faced with the electronic parts were
</p><p>Problem: Robocar would stop randomly during outdoor training <br>
Issue: The on/off switch was very susceptible to vibrations that only occurred when driving outside. These vibrations briefly interrupted power to the Jetson causing it to turn off. We fixed this by replacing the manual switch for the Jetson.
</p><p>Problem: Couldn't ssh to the Jetson <br>
Issue: Our wifi adapter installed in the beginning of the quarter failed, we had to revert back to the wifi usb to connect to the Jetson. This significantly slowed our workflow for the remainder of the quarter because the slow network connection resulted in slow file transfer. It was also frustratingly laggy to edit files over ssh.
</p><p>Problem: Jetson Nano 3.3V line broken <br>
Issue: We accidentally connected the 3.3V from the Jetson to V+ instead of VCC on the PWM board. As a result, this created a short and drew too much current from the Jetson into the PWM board. While the PWM board is fine, our wires melted and the 3.3V line no longer is able to produce the correct voltage from any of the pins on the Jetson. We solved this problem by using the 5V output pin on the Jetson. Since the PWM board is rated from 2.3V to 5.5V, we haven't experienced any problems with powering it after switching from 3.3V to 5V.
</p><p>Problem: Power Converter <br>
Issue: Our DC-DC converter broke and wasn't scaling down the voltage coming in from the LiPo battery. The broken converter only scaled-down the voltage from 12V to 6V instead of 12V to 5V. Since there is overvoltage protection on the Jetson, our Jetson refused to turn on when receiving 6V. We solved this issue by replacing the power converter.
</p>
<p><br>
</p>
<hr>
<h2><span class="mw-headline" id="The_Final_Prototype">The Final Prototype</span></h2>
<h3><span class="mw-headline" id="Results">Results</span></h3>
<p>We were able to achieve all of our deliverables of circling the track autonomously and delivering specific mail to different locations, in this case the package corresponding to the number on the sign.
To achieve this, we successfully implemented number recognition using OpenCV into the donkeycar framework that would trigger the mail delivery sequence when a number is detected.
We also successfully interfaced the continuous rotation servos with the PCA 9685 PWM board and integrated the part into the donkeycar framework so we could control it using the Jetson Nano.
On testing, we also confirmed that we could move the location of the signs around the track and the car would still stop at each one to deliver the package.
In full autonomous mode, we confirmed that the car could resume driving after delivering a package.
</p><p>We implemented one of our nice to haves, letting the user choose which package gets delivered to which driveway.
</p>
<h3><span class="mw-headline" id="Mail_Delivery_In_Action">Mail Delivery In Action</span></h3>
<div class="embedvideo ev_center autoResize" style=""><div class="embedvideowrap" style="width: 640px;"><iframe src="./2019FallTeam2 - MAE_ECE 148 - Introduction to Autonomous Vehicles Page_files/-6h5Rdy1oOc.html" width="640" height="360" frameborder="0" allowfullscreen="true"></iframe></div></div>
<p>While driving autonomously (local angle mode), the car is able to do laps around the track and stop at the signs to deliver the 3D printed packages. The car delivers the third package to the sign labeled three and the fourth package to the sign with the four. After delivering the package, the car is able to resume driving around the track.
</p><p>The package delivery also works in full autonomous mode.
</p>
<h3><span class="mw-headline" id="Future_Improvements.2FIdeas">Future Improvements/Ideas</span></h3>
<p>We could improve our DonkeyCar by improving the precision of the mail delivery and the robustness and accuracy of the number recognition system.
</p><p>Primarily, there are many changes we could make to the package delivery system. Some ideas include:
</p>
<ul><li> Implementing a control system with limit switches as end stops. We could then replace hard coded values such as the pulse time constant with a more robust system that can respond to any environmental factors that affect the speed of the pinion.</li>
<li> Decrease the weight of the mechanical components.</li>
<li> Add an additional driving routine that aligns the car with a driveway or a mailbox before pushing off the package.</li>
<li> Replace the pushing rack and pinion mechanism with a pick and place mechanical arm to more precisely place package at delivery location as well as deliver packages more delicately.</li>
<li> Use TOF sensors in order to be more precise when aligning the car with the driveway and for distance measurement.</li></ul>
<p>We could also increase the robustness of the number recognition system:
</p>
<ul><li> Take advantage of the GPU's on the Nvidia Jetson to implement a neural net to recognize numbers. (say how this improves model here)
<ul><li> Our current system requires us to drive relatively slowly to ensure that we don't miss the number signs in between camera captures.</li></ul></li>
<li> Test in different environments with different lighting. 
<ul><li> Each environment requires specific calibration in regards to lighting. If we were able to create multiple masks which screened for different RGB values depending on lighting, it would make our number recognition more accurate.</li></ul></li></ul>
<p><br>
</p>
<hr>
<h2><span class="mw-headline" id="References">References</span></h2>
<p>This is the starter code for the OpenCV number recognition we used: <a rel="nofollow" class="external free" href="https://www.pyimagesearch.com/2017/02/13/recognizing-digits-with-opencv-and-python/">https://www.pyimagesearch.com/2017/02/13/recognizing-digits-with-opencv-and-python/</a>
Donkeycar documentation: <a rel="nofollow" class="external free" href="http://docs.donkeycar.com/">http://docs.donkeycar.com</a>
</p>
